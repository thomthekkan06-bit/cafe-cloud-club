<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DEBUG MODE | Cafe Cloud Club</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=Outfit:wght@700;900&display=swap" rel="stylesheet">
    <style>
        body { background: #000; color: #fff; font-family: 'Inter', sans-serif; display: flex; flex-direction: column; padding: 20px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .col { border: 1px solid #333; padding: 20px; border-radius: 10px; }
        .card { background: #222; margin-bottom: 10px; padding: 15px; border-radius: 8px; border-left: 5px solid #555; }
        .card h2 { margin: 0; font-family: 'Outfit', sans-serif; }
        .card p { margin: 5px 0 0 0; color: #aaa; font-size: 0.9rem; }
        
        /* DEBUG BOX */
        #debug-box {
            position: fixed; bottom: 0; left: 0; width: 100%; height: 200px;
            background: #002200; color: #00ff00; font-family: monospace;
            padding: 20px; overflow-y: scroll; border-top: 2px solid #00ff00;
            z-index: 9999; font-size: 14px;
        }
    </style>
</head>
<body>

    <h1>ðŸš¨ DEBUG MODE: RAW DATA VIEW ðŸš¨</h1>
    <p>This screen ignores all rules. If this is empty, your database connection is broken.</p>

    <div class="grid">
        <div class="col">
            <h3>PREPARING SIDE</h3>
            <div id="prep-grid"></div>
        </div>
        <div class="col">
            <h3>READY SIDE</h3>
            <div id="ready-grid"></div>
        </div>
    </div>

    <div id="debug-box">Waiting for Firebase...<br></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // LOGGING TOOL
        const box = document.getElementById('debug-box');
        function log(msg) {
            box.innerHTML += `> ${msg}<br>`;
            box.scrollTop = box.scrollHeight;
        }

        const firebaseConfig = {
            apiKey: "AIzaSyB9d8Seuez7ihaTSAuPyoCwqjKIR1-VFKg",
            authDomain: "cafe-orders-1afa1.firebaseapp.com",
            databaseURL: "https://cafe-orders-1afa1-default-rtdb.firebaseio.com",
            projectId: "cafe-orders-1afa1",
            storageBucket: "cafe-orders-1afa1.firebasestorage.app",
            messagingSenderId: "274410745480",
            appId: "1:274410745480:web:9964c3914d512aed8d793d"
        };

        try {
            log("Initializing Firebase...");
            const app = initializeApp(firebaseConfig);
            const db = getDatabase(app);
            log("Firebase Initialized. Connecting to Database...");

            const ordersRef = ref(db, 'orders');

            onValue(ordersRef, (snapshot) => {
                log("ðŸŸ¢ CONNECTION SUCCESSFUL. Callback triggered.");
                
                const data = snapshot.val();
                const prepGrid = document.getElementById('prep-grid');
                const readyGrid = document.getElementById('ready-grid');
                prepGrid.innerHTML = ''; readyGrid.innerHTML = '';

                if (!data) {
                    log("ðŸ”´ DATA IS NULL. The 'orders' folder in your database is completely empty.");
                    log("Are your orders in 'history' instead? Kitchen Manager moves them to history when completed.");
                    return;
                }

                const orders = Object.values(data);
                log(`ðŸŸ¢ Found ${orders.length} orders. Rendering ALL of them...`);

                orders.forEach(order => {
                    log(`-- ID: ${order.orderId} | Status: ${order.status} | Type: ${order.orderType}`);

                    const div = document.createElement('div');
                    div.className = 'card';
                    div.innerHTML = `<h2>#${order.orderId}</h2><p>Status: <strong>${order.status}</strong></p><p>Type: ${order.orderType}</p>`;

                    // FOR DEBUGGING: Put everything in Prep except 'done'
                    if (order.status === 'done') {
                        readyGrid.appendChild(div);
                    } else {
                        prepGrid.appendChild(div);
                    }
                });

            }, (error) => {
                log(`ðŸ”´ PERMISSION ERROR: ${error.message}`);
                log(`ðŸ”´ ACTION: Go to Firebase Console > Realtime Database > Rules. Set .read to true.`);
            });

        } catch (e) {
            log(`CRITICAL ERROR: ${e.message}`);
        }
    </script>
</body>
</html>
